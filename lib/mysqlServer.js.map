{"version":3,"sources":["mysqlServer.js"],"names":["startMysql","process","platform","require","mysqld","startingPromise","readySet","stoppingPromise","mysqlServerReady","reinitialize","ready","then","resolve","stopMysqlServer","reject","stop","catch","err"],"mappings":";;;;;;;;;;;;;AACA,IAAIA,UAAJ;AACA,IAAIC,QAAQC,QAAR,KAAqB,OAAzB,EAAkC;AAChCF,eAAaG,QAAQ,0BAAR,CAAb;AACD,CAFD,MAEO;AACLH,eAAaG,QAAQ,0BAAR,CAAb;AACD;;AAED,IAAIC,SAAS,IAAb;AACA,IAAIC,kBAAkB,IAAtB;AACA,IAAIC,WAAW,KAAf;AACA,IAAIC,kBAAkB,IAAtB;AACO,MAAMC,8CAAmB,YAAW;AACzC,MAAIH,eAAJ,EAAqB;AACnB,WAAOA,eAAP;AACD;;AAED,MAAI,CAACC,QAAL,EAAe;AACbF,aAASJ,WAAW,IAAX,EAAiB,EAACS,cAAc,KAAf,EAAjB,CAAT;AACAJ,sBAAkBD,OAAOM,KAAP,CAAaC,IAAb,CAAkB,MAAM;AACxCL,iBAAW,IAAX;AACAD,wBAAkB,IAAlB;AACD,KAHiB,CAAlB;AAIA,WAAOA,eAAP;AACD,GAPD,MAOO;AACL,WAAO,kBAAQO,OAAR,CAAgB,IAAhB,CAAP;AACD;AACF,CAfM;;AAiBA,MAAMC,4CAAkB,YAAW;AACxC,MAAIN,eAAJ,EAAqB;AACnB,WAAOA,eAAP;AACD;;AAEDA,oBAAkB,sBAAY,CAACK,OAAD,EAAUE,MAAV,KAAqB;AACjDN,uBAAmBG,IAAnB,CAAwB,MAAM;AAC5B,aAAOP,OAAOW,IAAP,EAAP;AACD,KAFD,EAEGJ,IAFH,CAEQ,MAAM;AACZP,eAAS,IAAT;AACAC,wBAAkB,IAAlB;AACAC,iBAAW,KAAX;AACAC,wBAAkB,IAAlB;AACAK;AACD,KARD,EAQGI,KARH,CAQSC,OAAOH,OAAOG,GAAP,CARhB;AASD,GAViB,CAAlB;AAWA,SAAOV,eAAP;AACD,CAjBM","file":"mysqlServer.js","sourcesContent":["\r\nlet startMysql\r\nif (process.platform === 'win32') {\r\n  startMysql = require('mysql-server-5.7-win-x64')\r\n} else {\r\n  startMysql = require('mysql-server-5.7-osx-x64')\r\n}\r\n\r\nlet mysqld = null\r\nlet startingPromise = null\r\nlet readySet = false\r\nlet stoppingPromise = null\r\nexport const mysqlServerReady = function() {\r\n  if (startingPromise) {\r\n    return startingPromise\r\n  }\r\n\r\n  if (!readySet) {\r\n    mysqld = startMysql(null, {reinitialize: false})\r\n    startingPromise = mysqld.ready.then(() => {\r\n      readySet = true\r\n      startingPromise = null\r\n    })\r\n    return startingPromise\r\n  } else {\r\n    return Promise.resolve(true)\r\n  }\r\n}\r\n\r\nexport const stopMysqlServer = function() {\r\n  if (stoppingPromise) {\r\n    return stoppingPromise\r\n  }\r\n\r\n  stoppingPromise = new Promise((resolve, reject) => {\r\n    mysqlServerReady().then(() => {\r\n      return mysqld.stop()\r\n    }).then(() => {\r\n      mysqld = null;\r\n      startingPromise = null;\r\n      readySet = false;\r\n      stoppingPromise = null;\r\n      resolve();\r\n    }).catch(err => reject(err));\r\n  })\r\n  return stoppingPromise\r\n}"]}